<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8"></meta>
<title th:text="${title}+'-宅着玩'"></title>
<link rel="stylesheet" href="/static/layui/css/layui.css"></link>
<link rel="stylesheet" href="/static/css/personalCenter.css" />
<style type="text/css">
.layui-input-block{
margin-left:120px;
}
.layui-form-label {
width: 90px;
}
.layui-upload-img{width:120px; height: 160px; margin: 10px 10px 10px 0;}
</style>
<script src="/static/layui/layui.js"></script>
<script src="/static/js/jquery.js"></script>
<script th:inline="javascript">
/*<![CDATA[*/  
  $(document).ready(function(){
		  var downloadType = [[${gameInformation.downloadType}]];
		  var gameDownloadAddress = [[${gameInformation.gameDownloadAddress}]];
		  var linkPwd = [[${gameInformation.linkPwd}]];
		  $("#points").val([[${gameInformation.integral}]]);
		  $("#download_type").val(downloadType);
		  if(downloadType=="1"){
			  $("#addr1").show(); 
              $("#game_download_address1").val(gameDownloadAddress);
	    	  $("#link_pwd").val(linkPwd); 
		  }else{
			  $("#addr2").show(); 
              $("#game_download_address2").val(gameDownloadAddress); 
		  } 
			  
	    });

	layui.use(['element','form','layedit','upload'], function(){
	      var form=layui.form;
		  var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
		  var $ = layui.jquery,upload = layui.upload;
		  var layedit=layui.layedit;
		  
		  //普通图片上传
		  var uploadInst = upload.render({
		     elem: '#upload_Game_Btn'
		    ,url: '/user/gameInformation/uploadCoverImage'
		    ,size: 60 //限制文件大小，单位 KB
		    ,before: function(obj){
		      //预读本地文件示例，不支持ie8
		      obj.preview(function(index, file, result){
		        $('#upload_image').attr('src', result); //图片链接（base64）
		      });
		    }
		    ,done: function(res){
		      //如果上传失败
		      if(res.code > 0){
		        return layer.msg('上传失败');
		      }else{
		    	  $("#game_picture").attr("value",res.data.src);//图片路径
		      }
		      //上传成功
		    }
		    ,error: function(){
		      //演示失败状态，并实现重传
		      var demoText = $('#demo_text');
		      demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
		      demoText.find('.demo-reload').on('click', function(){
		        uploadInst.upload();
		      });
		    }
		  });
		  
		  var index=layedit.build('content',{
			  uploadImage:{
				  url:'/user/gameInformation/uploadContentImage',
				  type:'post'
			  }
		  });
		  
		  form.on('select(search_type)', function(data) {
		         if (data.value == 1) {
	                   $("#addr1").show(); 
	                   $("#addr2").hide();
	                   $("#game_download_address1").val("");
			    	   $("#link_pwd").val(""); 
				       $("#game_download_address2").val("");
					}else if (data.value == 2) {
					   $("#addr2").show(); 
					   $("#addr1").hide();
					   $("#game_download_address1").val("");
			    	   $("#link_pwd").val(""); 
				       $("#game_download_address2").val("");
				    }else{
			    	   $("#addr1").hide();
			    	   $("#addr2").hide();
			    	   $("#game_download_address1").val("");
			    	   $("#link_pwd").val(""); 
				       $("#game_download_address2").val("");
				    }
			});

		  $('#game_submit').on('click', function(){
			    var gamePicture =  $("#game_picture").val();
				var gameName = $("#game_name").val().trim();
				var gameTitle= $("#game_title").val().trim();
				var points = $("#points").val();
				var gameType = $("#game_type").val();
				var downloadType = $("#download_type").val();
				var addr1 = $("#game_download_address1").val();
				var addr2 = $("#game_download_address2").val();
				var gameId  = $("#game_id").val();
				var content=layedit.getContent(index);
				var gameDownloadAddress;
				
				
				if(content==""){
					 layer.msg("请输入资源描述！");
					  return false;
				}
				
				if(gameName==""){
					layer.msg("请输入游戏名称");
					 return false; 
				}
				
				if(gameTitle==""){
					layer.msg("请输入游戏标题");
					 return false; 
				}
				
				if(points==""){
					layer.msg("请选择积分");
					 return false; 
				}
				if(gameType==""){
					 layer.msg("请选择游戏类别");
					 return false; 
				}
			    if(downloadType==""){
			    	layer.msg("请选择分享方式");
					 return false;
			    }else if(downloadType=="1"){
			    	 if(addr1==""){
			    	    	 layer.msg("请输入百度云地址");
			    			 return false; 
			    	    }else{
			    	    	  gameDownloadAddress = addr1;
			    	    }
			    }else {
			    	 if(addr2==""){
			 	    	 layer.msg("请输入其他地址");
			 			 return false; 
			 	    }else{
			 	    	gameDownloadAddress = addr2;
			 	    }
			    }
			  
				  $.post("/admin/gameInformation/update",{
					id:gameId,
					gamePicture:gamePicture,
					gameName:gameName,
			    	gameTitle:gameTitle,
			    	integral:points,
			    	gameTypeId:gameType,
			    	downloadType:downloadType,
			    	gameDownloadAddress:gameDownloadAddress,
			    	gameDescribe:content
				 },function(result){
					 var index = parent.layer.getFrameIndex(window.name); 
				 	 if(result.success){
						 alert("修改成功");
						 parent.location.reload(); //刷新父页面
						 parent.layer.close(index); //当你在iframe页面关闭自身时
					
					 }else{
						alert("修改失败请重新尝试");
					 } 
				},"json"); 
			    
		  }); 
		  
});
	
	
/*]]>*/
	
</script>
</head>
<body>
      <div style="padding-left: 10px">
      		<form class="layui-form" >
				<div class="layui-form-item">
						<div class="layui-upload-list" style="float: left;">
						<label class="layui-form-label">游戏封面：</label>  
						 <img class="layui-upload-img" id="upload_image"  th:src="${gameInformation.gamePicture}"></img>
							<p id="demo_text"></p>
						</div>
						<div class="layui-upload" style="float: left; margin-top: 20px;">
							<button type="button" class="layui-btn" id="upload_Game_Btn">上传图片</button>
							<div class="layui-inline layui-word-aux">封面大小限制60KB</div>
						</div>
				</div>

				<div class="layui-form-item">
				    <label class="layui-form-label">游戏名称：</label>
				    <div class="layui-input-block">
				      <input  style="width: 400px" type="text" id="game_name" name="gameName" lay-verify="required" autocomplete="off" th:value="${gameInformation.gameName}" placeholder="请输入游戏名称" class="layui-input" maxlength="15"/>
				    </div>
				 </div>
      			<div class="layui-form-item">
				    <label class="layui-form-label">游戏标题：</label>
				    <div class="layui-input-block">
				      <input style="width: 400px" type="text" id="game_title" name="gameTitle" lay-verify="required" autocomplete="off" th:value="${gameInformation.gameTitle}" placeholder="请输入游戏标题" class="layui-input"  maxlength="50"/>
				    </div>
				 </div>

				<div class="layui-form-item">
					<label class="layui-form-label">积分设置：</label>
					<div class="layui-input-inline" style="width: 190px">
						<select id="points" name="points" lay-verify="required">
							<option value="">请选择积分</option>
							<option value="1">1个积分</option>
							<option value="2">2个积分</option>
							<option value="3">3个积分</option>
							<option value="4">4个积分</option>
							<option value="5">5个积分</option>
							<option value="6">6个积分</option>
							<option value="7">7个积分</option>
							<option value="8">8个积分</option>
							<option value="9">9个积分</option>
							<option value="10">10个积分</option>
						</select>
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">游戏类别：</label>
					<div class="layui-input-inline">
						<select name="dataDictionary.id" lay-verify="required" id="game_type">
							<option value="">请选择游戏类别</option>
							<option
								th:each="gameDataDictionary:${application.gameDataDictionaryList}"
								th:value="${gameDataDictionary.id}"
								th:text="${gameDataDictionary.dictionaryName}"
								th:selected="${gameDataDictionary.id==gameInformation.dataDictionary.id}"></option>
						</select>
					</div>
				</div>
				
				<div class="layui-form-item">
					<label class="layui-form-label">分享方式：</label>
					<div class="layui-input-inline">
						<select id="download_type" name="downloadType" lay-filter="search_type">
							<option value="">请选择分享方式</option>
							<option value="1">百度云盘</option>
							<option value="2">其他</option>
						</select>
					</div>
				</div>
				
				<div class="layui-form-item" id="addr1" style="display: none;">
					<label class="layui-form-label">分享地址：</label>
					<div class="layui-input-inline" style="width: 300px">
						<input type="text" id="game_download_address1"
							name="gameDownloadAddress" autocomplete="off"
							placeholder="请输入百度云分享地址" class="layui-input" maxlength="350" />
					</div>
					<div class="layui-input-inline" style="width: 90px">
						<input type="text" id="link_pwd" name="linkPwd"
							 autocomplete="off" placeholder="请输入密码"
							class="layui-input" maxlength="4"
							onKeyUp="value=value.replace(/[\W]/g,'')" />
					</div>
				</div>

				<div class="layui-form-item" id="addr2" style="display: none;">
					<label class="layui-form-label">分享地址：</label>

					<div class="layui-input-block">
						<input type="text" id="game_download_address2" style="width: 350px"
							name="gameDownloadAddress" autocomplete="off"
							placeholder="请输入其他分享地址" class="layui-input" maxlength="350" />
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">游戏描述：</label>
					<div class="layui-input-block" style="width: 600px">
						<textarea id="content" name="gameDescribe" style="display: none;"
							th:utext="${gameInformation.gameDescribe}"></textarea>
					</div>
				</div>

				<div class="layui-form-item">
				    <div class="layui-input-block">
				      <input type="hidden"  id="game_picture"  name="gamePicture" th:value="${gameInformation.gamePicture}"></input>
				      <input type="hidden" id="game_id" name="id" th:value="${gameInformation.id}"/>
				      <button class="layui-btn" id="game_submit" data-type="text">立即提交</button>
				    </div>
				  </div>
	      		</form>
	      	</div>
</body>
</html>